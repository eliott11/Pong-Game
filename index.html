<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        body {
            overflow:hidden;
        }
        #canvas {
            background-color: black;
        }
    </style>

</head>
<body>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        // canvas.width = "500";
        // canvas.height = "600";
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        //key detection
        const keyPressed = [];
        const KEY_UP = 40;
        const KEY_DOWN = 38;

        window.addEventListener('keydown', function (e) {
            // console.log(e.keyCode);
            keyPressed[e.keyCode] = false;
        });
        window.addEventListener('keyup', function (e) {
            keyPressed[e.keyCode] = true;
        });

        //fonction vecteurs
        function vec2(x, y) {
            return {x: x, y: y};
        }

        class Ball {
          constructor(pos, velocity, radius) {
            
            this.pos = pos;
            this.velocity = velocity;
            this.radius = radius;
          }

          update() {
              this.pos.x += this.velocity.x;
              this.pos.y += this.velocity.y;
          };

          draw() {
              ctx.fillStyle = "#BD00D7";
              ctx.strokeStyle = "#BD00D7";
              ctx.beginPath();
              ctx.arc(this.pos.x, this.pos.y, this.radius, 0, Math.PI * 2);
              ctx.fill();
              ctx.stroke();
          }
        }

        class Player {
          constructor(pos, velocity, width, height) {
            this.pos = pos;
            this.velocity = velocity;
            this.width = width;
            this.height = height;
          }

          update() {
              if (keyPressed[KEY_UP]) {
                  this.pos.y -= this.velocity.y;
              } 
              if (keyPressed[KEY_DOWN]) {
                  this.pos.y += this.velocity.y;
              }
          };
          
          draw() {
              ctx.fillStyle = "#BD00D7";
              ctx.fillRect(this.pos.x, this.pos.y, this.width, this.height);
          };
        }

        function ballCollision(ball) {
            //rebond bas
            if (ball.pos.y + ball.radius >= canvas.height) {
                ball.velocity.y *= -1;
            }
            //rebond haut
            if (ball.pos.y - ball.radius <= 0) { //0 = hauteur max
                ball.velocity.y *= -1;
            }
            //rebond côté droit
            if (ball.pos.x + ball.radius >= canvas.width) {
                ball.velocity.x *= -1;
            }
            //rebond côté gauche
            if (ball.pos.x - ball.radius <= 0) {
                ball.velocity.x *= -1;
            }
        }

        // let ballX = 200;
        // let ballY = 200;
        // let ballRadius = 50;
        // let ballVelocityX = 10;
        // let ballVelocityY = 10;
        // class balle :
        let ball = new Ball(vec2(200, 200), vec2(10, 10), 20);
        const player1 = new Player(vec2(10, 50), vec2(5, 5), 20, 220);
        const player2 = new Player(vec2(canvas.width - 30, 30), vec2(5, 5), 20, 220);

        function gameUpdate() {
            // ballX += ballVelocityX;
            // ballY += ballVelocityY;
            ball.update();
            player1.update();
            // player2.update();
            ballCollision(ball);

        }

        function gameDraw() {
            // ctx.beginPath();
            // ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
            // ctx.stroke();
            ball.draw();
            player1.draw();
            player2.draw();
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            window.requestAnimationFrame(gameLoop);
            gameUpdate();
            gameDraw();
        }

        gameLoop();
        
    </script>

</body>
</html>